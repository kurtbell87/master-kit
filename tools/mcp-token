#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
TOKEN_FILE="$ROOT_DIR/.mcp-token"

if [[ "${1:-}" == "--rotate" ]]; then
  rm -f "$TOKEN_FILE"
fi

if [[ ! -f "$TOKEN_FILE" ]]; then
  if command -v openssl >/dev/null 2>&1; then
    openssl rand -hex 32 > "$TOKEN_FILE"
  else
    python3 -c 'import secrets; print(secrets.token_hex(32))' > "$TOKEN_FILE"
  fi
  chmod 600 "$TOKEN_FILE"
fi

cat "$TOKEN_FILE"
